import{c as Fe,u as Ge,a as Te,b as ke,d as Oe,e as Ye,f as v,s as Re,g as Ee,h as Qe,i as $e,R as l,j as e,C as u,k as p,F as t,T as i,t as c,M as h,A as w,I as X,l as j,m as S,n as b,r as Ve,G as y,o as _,p as O,q as Y,S as R,B as Z,v as q,w as He,x as L,y as o,D as P,z as U,Q as We,E as ee,H as Be,J as Je,K as Ke,L as se,_ as Xe,N as Ze,O as qe,P as Le,U as Ue,V as ne,W as es,X as A,Y as ss,Z as ns,$ as is}from"./index-a621499c.js";import{I as rs,a as ie}from"./IconTrashFilled-ee0f55b7.js";const ts=Fe(N=>({})),as=()=>{var K;const{theme:N}=ts(),re=Ge(),{classes:M}=Te(),{companyId:g,prospectId:z}=ke();console.log(g);const D=Oe(),{state:{token:E,user:F,isAdmin:te}}=Ye(),C=v(Re),G=v(Ee),{data:Q}=v(Qe),{data:T}=v($e),[ce,$]=l.useState(!1),[oe,ae]=l.useState(!0),[d,le]=l.useState(),[de,V]=l.useState([]),[xe,f]=l.useState([]),[he,me]=l.useState([]),[je,H]=l.useState([]),[n,I]=l.useState(),[ue,W]=l.useState(!1),[pe,k]=l.useState(!1),[ge,B]=l.useState(!1),[Ce,ye]=l.useState(!1),[fe,J]=l.useState(!1),[we,Se]=l.useState(""),[_e,Ae]=l.useState(""),[De,Ie]=l.useState("");l.useEffect(()=>{if(!g)return;const s=Q.find(a=>a._id===g),r=G.filter(a=>a.customerId===g),x=T.filter(a=>a.customerId===g);if(V(x),me(r),H(r),le(s),r.length>0)if(z){const a=r.find(m=>m._id===z);a?(I(a),f(C.filter(m=>m.projectId===a._id))):(I(r[0]),f(C.filter(m=>m.projectId===r[0]._id)))}else I(r[0]),f(C.filter(a=>a.projectId===r[0]._id));ae(a=>!1)},[g,z,Q,G,T,C]);const ve=s=>{const r=G.find(a=>a._id===s);I(r);const x=C.filter(a=>a.projectId===s);f(x)},be=s=>{ne({theme:N,title:"Delete Company",loading:!1,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:j.titleText,children:"Are you sure you want to delete this Company? This action is destructive and you will have to company support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete Company",onConfirm:()=>{D(es({id:s,token:E})).unwrap().then(r=>{A("Delete Company",r==null?void 0:r.message,r.success?"success":"error"),r.success&&D(ss(r.data._id))}).catch(r=>{console.log(r==null?void 0:r.message)})},onCancel:()=>A("Delete Company","Operation canceled!","error")})},Pe=s=>{ne({theme:N,title:"Delete",loading:ce,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:j.titleText,children:"Are you sure you want to delete this Contact Person? This action is destructive and you will have to contact support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete",onConfirm:()=>{$(r=>!0),D(ns({token:E,id:s})).unwrap().then(r=>{A("Delete Contact",r==null?void 0:r.message,r.success?"success":"error"),r.success&&D(is(r.data._id))}).catch(r=>{console.log("Delete Contact: ",r==null?void 0:r.message),A("Delete Contact","An error occurred","error")}).finally(()=>{$(r=>!1)})},onCancel:()=>A("Delete","Operation canceled!","error")})},Ne=s=>{Se(s);const r=T.filter(x=>x.name.toLowerCase().includes(s.toLowerCase())&&x.customerId===g);V(r)},Me=s=>{Ae(s);const r=he.filter(x=>x.name.toLowerCase().includes(s.toLowerCase()));H(r)},ze=s=>{Ie(s);const r=C.filter(x=>x.projectId===(n==null?void 0:n._id)).filter((x,a)=>{var m;return`${a+1}`.toLowerCase().includes(s.toLowerCase())||((m=x.contactPerson)==null?void 0:m.name.toLowerCase().includes(s.toLowerCase()))||x.meetingPlace.toLowerCase().includes(s.toLowerCase())});f(r)};return oe?e.jsx("div",{children:"Loading..."}):d?e.jsxs(e.Fragment,{children:[e.jsx(u,{...p,children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",w:"100%",children:[e.jsx(i,{...c,size:"xl",align:"center"}),e.jsx(i,{...c,size:"xl",align:"center",children:d==null?void 0:d.name}),e.jsxs(h,{withArrow:!0,withinPortal:!0,position:"right-start",children:[e.jsx(h.Target,{children:e.jsx(w,{children:e.jsx(X,{size:16,stroke:1.3,color:j.titleText})})}),e.jsxs(h.Dropdown,{children:[e.jsx(h.Label,{children:"New"}),e.jsx(h.Item,{color:j.titleText,icon:e.jsx(S,{...b}),onClick:()=>k(!0),children:"Prospect"}),e.jsx(h.Item,{color:j.titleText,icon:e.jsx(S,{...b}),onClick:()=>B(!0),children:"Expense / Claim"}),e.jsx(h.Label,{children:"Options"}),e.jsx(h.Item,{c:j.titleText,icon:e.jsx(rs,{...b}),onClick:s=>{s.stopPropagation(),re(Ve.reports.list_nav(d==null?void 0:d._id))},children:"Reports"}),te&&e.jsx(h.Item,{color:"red",icon:e.jsx(ie,{size:b.size}),onClick:s=>{s.stopPropagation(),be(d==null?void 0:d._id)},children:"Delete"})]})]})]})}),e.jsxs(y,{children:[e.jsxs(y.Col,{span:3,children:[e.jsx(u,{...p,h:_(56),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...c,size:"md",children:"Prospects"}),e.jsxs(t,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(O,{size:"xs",radius:"md",value:_e,className:M.searchInput,placeholder:"Search by any field",icon:e.jsx(Y,{size:16}),onChange:s=>{var r;return Me((r=s.target)==null?void 0:r.value)}}),e.jsx(w,{variant:"filled",size:"sm",color:"dark",onClick:()=>k(!0),children:e.jsx(S,{size:16,stroke:1.3,color:j.white})})]})]})}),e.jsx(R,{type:"scroll",h:"80vh",children:je.map(s=>e.jsx(u,{shadow:"sm",mb:"xs",px:"sm",py:"xs",radius:"md",onClick:()=>ve(s._id),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(t,{direction:"column",align:"flex-start",children:[e.jsx(i,{...c,children:s.name}),e.jsx(Z,{variant:"filled",color:q[s.status],children:s==null?void 0:s.statusName})]}),(n==null?void 0:n._id)===s._id&&e.jsx(He,{size:24,color:j.titleText})]})},s._id))})]}),e.jsx(y.Col,{span:9,children:e.jsxs(L,{spacing:"xs",children:[e.jsxs(y,{children:[e.jsxs(y.Col,{span:7,children:[e.jsx(u,{...p,h:_(56),children:e.jsx(L,{spacing:"xs",children:e.jsxs(t,{direction:"row",align:"center",mt:_(4),children:[e.jsx(i,{...c,size:"md",children:"Details"}),(n==null?void 0:n.status)&&e.jsx(Z,{ml:"lg",variant:"filled",color:q[n==null?void 0:n.status],children:n==null?void 0:n.statusName})]})})}),n&&e.jsx(u,{...p,children:e.jsxs(t,{direction:"column",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Name: "}),e.jsx(i,{...o,children:(n==null?void 0:n.name)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Type: "}),e.jsx(i,{...o,children:(n==null?void 0:n.type)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Salesman: "}),e.jsx(i,{...o,children:n!=null&&n.salesPerson?(n==null?void 0:n.salesPerson)===(F==null?void 0:F._id)?"(You)":(K=n==null?void 0:n.salesPersonValue)==null?void 0:K.name:"N/A"})]})]}),e.jsxs(t,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Value: "}),e.jsx(i,{...o,children:n!=null&&n.value?Intl.NumberFormat("en-US",{style:"currency",currency:n==null?void 0:n.value.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(n==null?void 0:n.value.amount):"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Contract Date: "}),e.jsx(i,{...o,children:n!=null&&n.contractDate?P.fromISO(n==null?void 0:n.contractDate).toFormat(U):"N/A"})]})]}),e.jsxs(t,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Quotation: "}),e.jsx(i,{...o,children:(n==null?void 0:n.quotation)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Delivery Date: "}),e.jsx(i,{...o,children:n!=null&&n.deliveryDate?P.fromISO(n==null?void 0:n.deliveryDate).toFormat(U):"N/A"})]})]}),e.jsxs(t,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...c,children:"Description: "}),e.jsx(i,{...o,children:(n==null?void 0:n.description)||"N/A"})]})]})})]}),e.jsxs(y.Col,{span:5,children:[e.jsx(u,{...p,h:_(56),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...c,size:"md",children:"Contacts"}),e.jsxs(t,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(O,{size:"xs",radius:"md",value:we,className:M.searchInput,placeholder:"Search by any field",icon:e.jsx(Y,{size:16}),onChange:s=>{var r;return Ne((r=s.target)==null?void 0:r.value)}}),e.jsx(w,{variant:"filled",size:"sm",color:"dark",onClick:()=>W(!0),children:e.jsx(S,{size:16,stroke:1.3,color:j.white})})]})]})}),e.jsx(R,{type:"scroll",h:"36vh",children:de.map(s=>e.jsx(u,{...p,children:e.jsx(l.Fragment,{children:e.jsxs(t,{direction:"row",justify:"flex-start",align:"flex-start",columnGap:"sm",children:[e.jsx(t,{my:"auto",children:e.jsx(We,{src:s.businessCard?`${ee}\\${s.businessCard}`:"/user.png",children:e.jsx(Be,{src:s.businessCard?`${ee}\\${s.businessCard}`:"/user.png",size:88})},s._id)}),e.jsxs(t,{direction:"column",w:"100%",children:[e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...c,mr:"xs",children:"Name:"}),e.jsx(i,{...o,children:(s==null?void 0:s.name)||"N/A"})]}),e.jsxs(h,{withinPortal:!0,withArrow:!0,position:"bottom-end",children:[e.jsx(h.Target,{children:e.jsx(w,{children:e.jsx(X,{size:16,stroke:1.3,color:j.titleText})})}),e.jsxs(h.Dropdown,{children:[e.jsx(h.Label,{children:"Options"}),e.jsx(h.Item,{color:"red",icon:e.jsx(ie,{stroke:1.3,size:16}),onClick:()=>Pe(s._id),children:"Delete"})]})]})]}),e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...c,mr:"xs",children:"Email:"}),e.jsx(Je,{...o,href:s==null?void 0:s.email,target:"_blank",c:"blue",children:(s==null?void 0:s.email)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...c,mr:"xs",children:"Mobile No.:"}),e.jsx(i,{...o,children:(s==null?void 0:s.mobile)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...c,mr:"xs",children:"Designation:"}),e.jsx(i,{...o,children:(s==null?void 0:s.designation)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...c,mr:"xs",children:"Department:"}),e.jsx(i,{...o,children:(s==null?void 0:s.department)||"N/A"})]})]})]})},s._id)}))})]})]}),e.jsxs("div",{children:[e.jsx(u,{...p,h:_(56),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...c,size:"md",children:"Meetings / Follow Up:"}),e.jsxs(t,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(O,{miw:"24vw",size:"xs",radius:"md",value:De,className:M.searchInput,placeholder:"Search by contact, place, No.",icon:e.jsx(Y,{size:16}),onChange:s=>{var r;return ze((r=s.target)==null?void 0:r.value)}}),e.jsx(w,{variant:"filled",size:"sm",color:"dark",onClick:()=>J(!0),children:e.jsx(S,{size:16,stroke:1.3,color:j.white})})]})]})}),e.jsx(R,{type:"scroll",h:"33vh",children:xe.map((s,r)=>{var a,m;const x=s!=null&&s.expensePrice?Intl.NumberFormat("en-US",{style:"currency",currency:s.expensePrice.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(s.expensePrice.amount):"N/A";return Ke.createElement(u,{...p,key:s._id},e.jsx(l.Fragment,{children:e.jsxs(t,{direction:"row",justify:"space-between",children:[e.jsxs(t,{direction:"column",my:"md",children:[e.jsxs(i,{...c,mb:"xs",children:["#",r+1]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Date/Time: "}),e.jsx(i,{...o,children:P.fromISO(s.meetingDate).toFormat(se)})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Location:"}),e.jsx(i,{...o,children:s.meetingPlace})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Meeting With:"}),e.jsx(i,{...o,children:(a=s.contactPerson)==null?void 0:a.name})]}),e.jsxs(t,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...c,children:"Agenda:"}),e.jsx(i,{...o,children:s.meetingAgenda})]}),e.jsxs(t,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...c,children:"Summary:"}),e.jsx(i,{...o,children:s.meetingSummary})]})]}),e.jsxs(t,{direction:"column",my:"md",children:[e.jsx(i,{...c,mb:"xs",children:"Next Visit"}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Date/Time: "}),e.jsx(i,{...o,children:s.nextMeetingDate?P.fromISO(s.nextMeetingDate).toFormat(se):"---"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Agenda:"}),e.jsx(i,{...o,children:s.nextMeetingAgenda})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Place:"}),e.jsx(i,{...o,children:s.nextMeetingPlace})]})]}),e.jsxs(t,{direction:"column",my:"md",children:[e.jsx(i,{...c,mb:"xs",children:"Expense / Claim"}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Name:"}),e.jsx(i,{...o,children:s==null?void 0:s.expenseName})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Type:"}),e.jsx(i,{...o,children:((m=s==null?void 0:s.expenseTypeDetail)==null?void 0:m.name)||"---"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...c,children:"Price:"}),e.jsx(i,{...o,children:x})]})]})]})}))})})]})]})})]}),e.jsx(Xe,{title:"Add Prospect",opened:pe,onClose:()=>k(!1),companyId:d._id}),e.jsx(Ze,{title:"Add Contact",opened:ue,companyId:d._id,onClose:()=>W(!1)}),e.jsx(qe,{title:"Add Follow Up",opened:fe,projectId:n==null?void 0:n._id,companyId:d._id,onClose:()=>J(!1)}),e.jsx(Le,{title:"Add Claim",opened:ge,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>B(!1)}),e.jsx(Ue,{title:"Add Purchase Request",opened:Ce,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>ye(!1)})]}):e.jsx("center",{children:"No such company exits..."})};export{as as CompanyProspects,as as default};
