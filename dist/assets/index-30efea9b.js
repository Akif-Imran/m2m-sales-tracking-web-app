import{c as O,o as h,ab as ce,ae as U,ac as F,a as ue,d as he,e as V,f as me,af as pe,R as u,ag as Ce,aX as Ie,X as p,aY as ke,aZ as ve,a_ as we,j as e,ah as Ae,ai as Te,v as z,G as le,F as j,H as ge,aj as be,a8 as R,ak as De,y as N,a5 as $,al as G,a$ as qe,C as xe,Q as Fe,B as ie,b0 as Ne,T as l,M as b,A as _e,l as k,I as Re,aF as ze,ax as Be,V as Me,b1 as Ue,b2 as $e,b3 as Ge,z as Oe,m as Ve,S as Ee}from"./index-cf1e1a34.js";const Le=O(s=>({})),Pe=O({fileUploadButton:{marginTop:h(-32),marginLeft:h(128)}}),Ye=ce().shape({no:U().required("No is required"),name:F().required("Name is required"),type:F().required("Type is required"),cost:ce().shape({amount:U().required("Value is required"),currency:F().required("Currency is required")}),assignedTo:F().optional(),status:U().required("Status is required"),image:F().required("Image is required")}),de=s=>{var E,L,P,Y,H,Q,W,X,Z,J,K,ee,se;const{opened:v,onClose:f,title:C,mode:a="add"}=s,{theme:m}=Pe(),{classes:D}=ue(),y=he(),{state:{token:I}}=V(),{stockItemStatus:w,engineers:g,salesPersons:x}=me(pe),[A,S]=u.useState(!1),[i,B]=u.useState({}),t=Ce({initialValues:{no:a==="edit"&&((E=s.record)==null?void 0:E.no)||1,name:a==="edit"&&((L=s.record)==null?void 0:L.name)||"",type:a==="edit"&&((P=s.record)==null?void 0:P.type)||"",assignedTo:a==="edit"&&((Y=s.record)==null?void 0:Y.assignedTo)||"",image:a==="edit"&&((H=s.record)==null?void 0:H.image)||"",status:a==="edit"&&((Q=s.record)==null?void 0:Q.status)||1,cost:{amount:a==="edit"&&((X=(W=s.record)==null?void 0:W.cost)==null?void 0:X.amount)||0,currency:a==="edit"&&((J=(Z=s.record)==null?void 0:Z.cost)==null?void 0:J.currency)||"MYR"}},validationSchema:Ye,onSubmit:(r,o)=>{console.log(r),a==="add"?T(r,o):M(r,o)}}),d=()=>{t.resetForm(),f()},T=(r,o)=>{S(n=>!0),y(Ie({token:I,stockItem:r})).unwrap().then(n=>{p("Add Stock",n==null?void 0:n.message,n.success?"success":"error"),n.success&&(y(ke(n.data)),o.resetForm(),f())}).catch(n=>{console.log("Add Stock: ",n==null?void 0:n.message),p("Add Stock","An error occurred","error")}).finally(()=>{S(n=>!1)})},M=(r,o)=>{var n;S(c=>!0),y(ve({token:I,id:((n=s.record)==null?void 0:n._id)||"",stockItem:r})).unwrap().then(c=>{p("Update Stock",c==null?void 0:c.message,c.success?"success":"error"),c.success&&(y(we(c.data)),o.resetForm(),f())}).catch(c=>{console.log("Update Stock: ",c==null?void 0:c.message),p("Update Stock","An error occurred","error")}).finally(()=>{S(c=>!1)})},je=r=>{if(r===null){p("Image Upload","Item image not uploaded","error");return}B(r);const o=new FileReader;o.onload=n=>{var q;const c=(q=n==null?void 0:n.target)==null?void 0:q.result;c&&t.setValues(_=>({..._,image:c}))},o.readAsDataURL(r)},fe=r=>{r&&t.setValues(o=>({...o,assignedTo:r}))},ye=r=>{r&&t.setValues(o=>({...o,status:parseInt(r)}))},Se=r=>{r&&t.setValues(o=>({...o,cost:{...o.cost,currency:r}}))};return u.useEffect(()=>{a==="edit"&&!s.record||t.setValues(r=>{var o,n,c,q,_,te,ae,re,ne,oe;return{...r,no:a==="edit"&&((o=s.record)==null?void 0:o.no)||1,name:a==="edit"&&((n=s.record)==null?void 0:n.name)||"",type:a==="edit"&&((c=s.record)==null?void 0:c.type)||"",assignedTo:a==="edit"&&((q=s.record)==null?void 0:q.assignedTo)||"",image:a==="edit"&&((_=s.record)==null?void 0:_.image)||"",status:a==="edit"&&((te=s.record)==null?void 0:te.status)||1,cost:{amount:a==="edit"&&((re=(ae=s.record)==null?void 0:ae.cost)==null?void 0:re.amount)||0,currency:a==="edit"&&((oe=(ne=s.record)==null?void 0:ne.cost)==null?void 0:oe.currency)||"MYR"}}})},[s.record,a]),e.jsx(Ae,{size:"md",withinPortal:!0,withOverlay:!0,title:C,opened:v,onClose:f,overlayProps:Te(m),children:e.jsx(z,{children:e.jsx(le,{children:e.jsx(le.Col,{span:12,children:e.jsxs(z,{spacing:"xs",children:[e.jsxs(j,{direction:"column",align:"center",justify:"flex-end",children:[t.values.image?e.jsx(ge,{src:t.values.image,radius:"md",size:h(170)}):e.jsx("div",{style:{width:h(170),height:h(170),borderRadius:m.radius.md,backgroundColor:`${m.colors[m.primaryColor][1]}`}}),e.jsx("div",{className:D.fileUploadButton,children:e.jsx(be,{onChange:je,accept:"image/png,image/jpeg",children:r=>e.jsx(R,{radius:"xl",variant:"filled",color:m.primaryColor,...r,disabled:!t.values.image,rightIcon:e.jsx(De,{size:16,color:m.white,stroke:1.5}),children:"Image"})})})]}),e.jsx(N,{maw:"50%",required:!0,withAsterisk:!1,label:"No. / ID",name:"no",id:"no",value:t.values.no,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.no&&t.errors.no?t.errors.no:"",type:"number",inputMode:"numeric"}),e.jsxs($,{align:"flex-start",grow:!0,children:[e.jsx(N,{required:!0,withAsterisk:!1,label:"Name",name:"name",id:"name",value:t.values.name,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.name&&t.errors.name?t.errors.name:""}),e.jsx(N,{required:!0,withAsterisk:!1,label:"Type",name:"type",id:"type",value:t.values.type,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.type&&t.errors.type?t.errors.type:""})]}),e.jsx(G,{required:!0,withAsterisk:!1,searchable:!0,nothingFound:"No such assignee",label:"Assign To",value:t.values.assignedTo,onChange:fe,data:[...g,...x],error:t.errors.assignedTo&&t.touched.assignedTo?`${t.errors.assignedTo}`:null}),e.jsxs($,{align:"flex-start",grow:!0,children:[e.jsx(G,{required:!0,withAsterisk:!1,searchable:!0,nothingFound:"No status found",label:"Status",value:t.values.status.toString(),onChange:ye,data:w,error:t.errors.status&&t.touched.status?`${t.errors.status}`:null}),e.jsx(N,{required:!0,withAsterisk:!1,label:"Cost",name:"cost.amount",id:"cost.amount",type:"number",value:t.values.cost.amount,onChange:t.handleChange,onBlur:t.handleBlur,rightSectionWidth:h(88),rightSection:e.jsx(G,{required:!0,withAsterisk:!1,searchable:!0,radius:"xl",variant:"unstyled",nothingFound:"No such currency",value:t.values.cost.currency,onChange:Se,data:qe}),error:(K=t.errors.cost)!=null&&K.amount&&((ee=t.touched.cost)!=null&&ee.amount)?`${(se=t.errors.cost)==null?void 0:se.amount}`:null})]}),e.jsxs($,{align:"flex-end",position:"right",mt:h(32),children:[e.jsx(R,{variant:"outline",onClick:d,size:"xs",children:"Cancel"}),e.jsx(R,{size:"xs",variant:"filled",loading:A,onClick:()=>t.handleSubmit(),children:"Save"})]})]})})})})})},He=O(s=>({machineImageContainer:{display:"flex",paddingRight:h(4),flexDirection:"column",justifyContent:"flex-start",alignItems:"center"}})),Qe=({item:s,setForEdit:v})=>{var A;const{theme:f,classes:C}=He(),a=he(),{state:{isAdmin:m,token:D}}=V(),[y,I]=u.useState(!1),w=S=>{Me({theme:f,title:"Delete Stock Item",loading:y,description:e.jsx(l,{fw:"normal",fs:"normal",fz:"sm",color:k.titleText,children:"Are you sure you want to delete this Stock item? This action is destructive and you will have to contact support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete",onConfirm:()=>{I(i=>!0),a(Ue({token:D,id:S})).unwrap().then(i=>{p("Delete Stock Item",i==null?void 0:i.message,i.success?"success":"error"),i.success&&a($e(S))}).catch(i=>{console.log("Delete Stock Item: ",i==null?void 0:i.message),p("Delete Stock Item","An error occurred","error")}).finally(()=>{I(i=>!1)})},onCancel:()=>p("Delete Stock Item","Operation canceled!","error")})},g={fw:700,c:k.titleText,size:"sm"},x={fz:"sm",color:k.titleText};return e.jsx(xe,{shadow:"md",m:"xs",children:e.jsx(z,{spacing:"xs",children:e.jsxs(j,{direction:"row",justify:"flex-start",columnGap:"sm",children:[e.jsxs("div",{className:C.machineImageContainer,children:[e.jsx(Fe,{src:s!=null&&s.image?`${s==null?void 0:s.image}`:"/user.png",children:e.jsx(ge,{src:s!=null&&s.image?`${s==null?void 0:s.image}`:"/user.png",radius:s!=null&&s.image?h(250):h(250),size:"xl",styles:s!=null&&s.image?void 0:noImageStyle})},s._id),e.jsx(ie,{variant:"light",color:Ne[s.status],mt:"sm",children:e.jsx(l,{children:s.statusName})})]}),e.jsxs(j,{direction:"column",columnGap:"sm",w:"100%",children:[e.jsxs(j,{direction:"row",justify:"space-between",children:[e.jsxs(j,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(l,{...g,children:"No: "}),e.jsx(l,{...x,children:s.no})]}),m?e.jsxs(b,{withArrow:!0,withinPortal:!0,children:[e.jsx(b.Target,{children:e.jsx(_e,{color:k.titleText,children:e.jsx(Re,{})})}),e.jsxs(b.Dropdown,{children:[e.jsx(b.Label,{children:"Options"}),e.jsx(b.Item,{onClick:()=>v(s),icon:e.jsx(ze,{size:16}),color:k.titleText,children:"Edit"}),e.jsx(b.Item,{color:"red",icon:e.jsx(Be,{size:16}),onClick:()=>w(s._id),children:"Delete"})]})]}):e.jsx(ie,{variant:"light",color:"red",children:e.jsx(l,{children:"Admin Required"})})]}),e.jsxs(j,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(l,{...g,children:"Name: "}),e.jsx(l,{...x,children:s.name})]}),e.jsxs(j,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(l,{...g,children:"Type: "}),e.jsx(l,{...x,children:s.type})]}),e.jsxs(j,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(l,{...g,children:"Assigned To: "}),e.jsx(l,{...x,children:((A=s.assignee)==null?void 0:A.name)||"N/A"})]}),e.jsxs(j,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(l,{...g,children:"Cost: "}),e.jsx(l,{...x,children:Intl.NumberFormat("en-US",{style:"currency",currency:s.cost.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(s.cost.amount||0)})]})]})]})})},s._id)},Xe=()=>{Le();const{state:{isAdmin:s,isHR:v}}=V(),{classes:f}=ue(),C=me(Ge),[a,m]=u.useState(""),[D,y]=u.useState(!1),[I,w]=u.useState(!1),[g,x]=u.useState([]),[A,S]=u.useState({}),i=u.useCallback(d=>{S(d),w(!0)},[]),B=d=>{if(m(d),s||v){const T=C.filter(M=>M.name.toLowerCase().includes(d.toLowerCase()));x(T)}};u.useEffect(()=>{x(C)},[s,v,C]);const t=g.length===0?e.jsx("center",{children:e.jsx(l,{color:k.titleText,align:"center",children:"No Stock items..."})}):e.jsx(e.Fragment,{children:g.map(d=>e.jsx(Qe,{item:d,setForEdit:i},d._id))});return e.jsx(xe,{radius:"md",shadow:"md",h:"92vh",py:"xs",mb:"xs",children:e.jsxs(z,{children:[e.jsx(l,{fz:h(25),m:"xs",color:k.titleText,children:"Stock Items"}),e.jsxs(j,{gap:"md",m:"xs",className:f.searchContainer,children:[e.jsx(N,{value:a,className:f.searchInput,placeholder:"Search by any field",icon:e.jsx(Oe,{size:16}),onChange:d=>{var T;return B((T=d.target)==null?void 0:T.value)}}),s&&e.jsx(R,{variant:"filled",rightIcon:e.jsx(Ve,{size:16}),onClick:()=>y(!0),children:"Item"})]}),e.jsx(Ee,{type:"scroll",h:"72vh",children:t}),e.jsx(de,{mode:"add",title:"Add Stock Item",record:void 0,opened:D,onClose:()=>y(!1)}),e.jsx(de,{mode:"edit",title:"Update Stock Item",record:A,opened:I,onClose:()=>w(!1)})]})})};export{Xe as StockItems,Xe as default};
