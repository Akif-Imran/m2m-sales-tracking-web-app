import{c as J,ab as oe,ac as A,ad as le,ae as ie,a as F,e as U,f as T,af as K,d as q,R as x,ag as Z,j as e,ah as ee,ai as se,x as P,F as ae,H as B,o as _,aj as ce,a8 as k,ak as de,p as te,a5 as I,al as O,a6 as M,a7 as V,l as N,am as re,an as ue,X as j,ao as he,ap as me,a3 as E,S as z,aq as Y,ar as pe,as as xe,at as je,Q as fe,E as H,B as G,au as ge,av as Ce,D as Q,z as W,A as X,aw as Le,ax as Se,q as De,m as we,aa as ye,V as ve,T as Ae,ay as ke}from"./index-a621499c.js";const be=J(i=>({})),Re=J(i=>({})),_e=oe().shape({document:A().required("Type is required").nullable(),hasDocument:le().required("Type is required"),name:A().required("Name is required"),reason:A().required("Reason is required"),startDate:A().required("Start Date is required"),endDate:A().required("End Date is required"),status:ie().required("Status is required").min(1).max(3),type:A().required("Type is required")}),Ie=({onClose:i,opened:y,title:L})=>{const{theme:c}=Re(),{classes:h}=F(),{state:{token:S}}=U(),{leaveStatus:v,leaveTypes:D}=T(K),b=v.filter(r=>r.label==="Pending"),f=q(),[g,m]=x.useState(!1),[w,l]=x.useState({}),t=Z({initialValues:{document:"",hasDocument:!1,name:"",reason:"",startDate:"",endDate:"",status:1,type:"Paid"},validationSchema:_e,onSubmit:async(r,s)=>{if(console.log(r),m(n=>!0),r.hasDocument){const n=await ue(S,w);if(n.statusCode===200||n.statusCode===201)r.document=n.data;else{m(d=>!1),j("Add Leave",n==null?void 0:n.message,"error");return}}f(he({token:S,leave:r})).unwrap().then(n=>{j("Add Leave",n==null?void 0:n.message,n!=null&&n.success?"success":"error"),n.success&&(f(me(n.data)),s.resetForm(),i())}).catch(n=>{console.log("Add leave: ",n==null?void 0:n.message),j("Add Leave","An error occurred","error")}).finally(()=>{m(n=>!1)})}}),R=r=>{if(r===null){j("Proof Upload","Proof image not uploaded","error");return}l(n=>r);const s=new FileReader;s.onload=n=>{var $;const d=($=n==null?void 0:n.target)==null?void 0:$.result;d&&t.setValues(ne=>({...ne,document:d,hasDocument:!0}))},s.readAsDataURL(r)},o=r=>{var n;if(!r)return;const s=(n=D.find(d=>d.value===r))==null?void 0:n.label;s&&t.setValues(d=>({...d,type:s}))},u=r=>{var n;!r||!((n=v.find(d=>d.value===r))!=null&&n.label)||t.setValues(d=>({...d,status:parseInt(r)}))},C=r=>{r&&t.setValues(s=>({...s,startDate:E(r)}))},p=r=>{r&&t.setValues(s=>({...s,endDate:E(r)}))},a=()=>{t.resetForm(),i()};return e.jsx(ee,{size:"xl",withinPortal:!0,withOverlay:!0,title:L,opened:y,onClose:i,overlayProps:se(c),children:e.jsxs(P,{children:[e.jsxs(ae,{direction:"column",align:"center",justify:"flex-end",children:[t.values.document?e.jsx(B,{src:`${t.values.document}`,radius:"md",size:_(170)}):e.jsx(B,{src:"/user.png",radius:_(250),size:_(170)}),e.jsx("div",{className:h.fileUploadButton,children:e.jsx(ce,{onChange:R,accept:"image/png,image/jpeg",children:r=>e.jsx(k,{radius:"xl",variant:"filled",color:c.primaryColor,...r,rightIcon:e.jsx(de,{size:16,color:c.white,stroke:1.5}),children:"Proof"})})})]}),e.jsx(te,{required:!0,withAsterisk:!1,label:"Name",name:"name",id:"name",value:t.values.name,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.name&&t.errors.name?`${t.errors.name}`:null}),e.jsxs(I,{grow:!0,align:"flex-start",children:[e.jsx(O,{required:!0,withAsterisk:!1,searchable:!0,nothingFound:"No such type",label:"Type",value:t.values.type,onChange:o,data:D,error:t.touched.type&&t.errors.type?`${t.errors.type}`:null}),e.jsx(O,{required:!0,withAsterisk:!1,searchable:!0,nothingFound:"No such status",label:"Status",value:t.values.status.toString(),onChange:u,data:b,error:t.touched.status&&t.errors.status?`${t.errors.status}`:null})]}),e.jsxs(I,{grow:!0,align:"flex-start",children:[e.jsx(M,{required:!0,withAsterisk:!1,placeholder:"Select Start Date",name:"startDate",id:"startDate",label:"Start Date",onBlur:t.handleBlur,onChange:C,icon:e.jsx(V,{size:16,stroke:1.5,color:N.titleText}),error:t.touched.startDate&&t.errors.startDate?`${t.errors.startDate}`:null}),e.jsx(M,{required:!0,withAsterisk:!1,placeholder:"Select End Date",name:"endDate",id:"endDate",label:"End Date",onBlur:t.handleBlur,onChange:p,icon:e.jsx(V,{size:16,stroke:1.5,color:N.titleText}),error:t.touched.endDate&&t.errors.endDate?`${t.errors.endDate}`:null})]}),e.jsx(re,{minRows:5,maxRows:5,label:"Reason",name:"reason",id:"reason",value:t.values.reason,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.reason&&t.errors.reason?`${t.errors.reason}`:null}),e.jsxs(I,{align:"flex-end",position:"right",mt:_(32),children:[e.jsx(k,{variant:"outline",onClick:a,size:"xs",children:"Cancel"}),e.jsx(k,{size:"xs",variant:"filled",loading:g,onClick:()=>t.handleSubmit(),children:"Save"})]})]})})},Te=({onClose:i,opened:y,title:L,leaveId:c,statusId:h})=>{const{theme:S,classes:v}=F(),D=q(),{state:{token:b}}=U(),{leaveStatus:f}=T(K),[g,m]=x.useState(!1),w=T(o=>o.leaves.data.find(u=>u._id===c));console.log(h,c);const l=Z({initialValues:{leaveId:c,statusId:h,statusName:"",remarks:""},onSubmit:(o,u)=>{console.log(o),m(s=>!0);const{name:C,type:p,startDate:a,endDate:r}=w;D(pe({id:o.leaveId,token:b,leave:{name:C,type:p,startDate:a,endDate:r,status:o.statusId,remarks:o.remarks}})).unwrap().then(s=>{j("Update Leave",s==null?void 0:s.message,s!=null&&s.success?"success":"error"),s.success&&(D(xe(s.data)),u.resetForm(),i())}).catch(s=>{console.log("Update Leave",s==null?void 0:s.message),j("Update Leave","An error occurred","error")}).finally(()=>{m(s=>!1)})}}),t=o=>{var C;if(!o){j("Update Purchase Request Status","Invalid status value","error");return}const u=(C=f.find(p=>p.value===o))==null?void 0:C.label;u&&l.setValues(p=>({...p,statusId:parseInt(o),statusName:u}))},R=()=>{l.resetForm(),i()};return x.useEffect(()=>{l.setValues(o=>({...o,statusId:h,leaveId:c}))},[c,h]),e.jsx(ee,{size:"lg",radius:"md",opened:y,onClose:i,title:L,scrollAreaComponent:z.Autosize,withinPortal:!0,withOverlay:!0,overlayProps:se(S),children:e.jsxs(P,{children:[e.jsx(Y.Group,{name:"leaveStatus",value:l.values.statusId.toString(),onChange:t,children:e.jsx("div",{className:v.radioContainerRow,children:f.map(o=>e.jsx(Y,{value:o.value,label:o.label},o.value))})}),e.jsx(re,{minRows:5,maxRows:5,label:"Remarks",name:"remarks",id:"remarks",value:l.values.remarks,onChange:l.handleChange,onBlur:l.handleBlur}),e.jsxs(I,{align:"flex-end",position:"right",mt:_(32),children:[e.jsx(k,{variant:"outline",onClick:R,size:"xs",children:"Cancel"}),e.jsx(k,{size:"xs",variant:"filled",loading:g,onClick:()=>l.handleSubmit(),children:"Save"})]})]})})},Be=()=>{be();const{state:{isAdmin:i,isHR:y,user:L}}=U(),c=q(),{classes:h,theme:S}=F(),[v,D]=x.useState(""),[b,f]=x.useState(!1),g=T(je),[m,w]=x.useState([]),[l,t]=x.useState({statusId:0,leaveId:"",visible:!1}),R=(a,r)=>{t(s=>({...s,statusId:a,leaveId:r,visible:!0}))},o=()=>t(a=>({...a,visible:!1})),u=a=>{if(D(a),i||y){const r=g.filter(s=>{var n;return s.name.toLowerCase().includes(a.toLocaleLowerCase())||s.type.toLowerCase().includes(a.toLocaleLowerCase())||((n=s==null?void 0:s.statusName)==null?void 0:n.toLowerCase().includes(a.toLocaleLowerCase()))||s.remarks.toLowerCase().includes(a.toLocaleLowerCase())||s.reason.toLowerCase().includes(a.toLocaleLowerCase())});w(r)}else{const r=g.filter(s=>{var n;return(s.name.toLowerCase().includes(a.toLocaleLowerCase())||s.type.toLowerCase().includes(a.toLocaleLowerCase())||((n=s==null?void 0:s.statusName)==null?void 0:n.toLowerCase().includes(a.toLocaleLowerCase()))||s.remarks.toLowerCase().includes(a.toLocaleLowerCase())||s.reason.toLowerCase().includes(a.toLocaleLowerCase()))&&s.createdBy===(L==null?void 0:L._id)});w(r)}};x.useEffect(()=>{w(g)},[g]);const C=a=>{ve({theme:S,title:"Delete Leave",loading:!1,description:e.jsx(Ae,{fw:"normal",fs:"normal",fz:"sm",color:N.titleText,children:"Are you sure you want to delete this Leave? This action is destructive and you will have to contact support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete Leave",onConfirm:()=>{c(ke(a)),j("Delete Leave","Leave deleted successfully!","success")},onCancel:()=>j("Delete Leave","Operation canceled!","error")})},p=m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:14,color:N.titleText,align:"center",children:"No Leaves"})}):e.jsx(e.Fragment,{children:m.map((a,r)=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:e.jsx(fe,{src:a.document?`${H}\\${a.document}`:"/user.png",children:e.jsx(B,{src:a.document?`${H}\\${a.document}`:"/user.png",size:50})},a._id)}),e.jsx("td",{children:a.name}),e.jsx("td",{children:e.jsx(G,{variant:"filled",color:ge[a.status],children:a.statusName})}),e.jsx("td",{children:((s=a.requestByPerson)==null?void 0:s.name)||"N/A"}),e.jsx("td",{children:e.jsx(G,{variant:"filled",color:Ce[a.type],children:a.type})}),e.jsx("td",{children:Q.fromISO(a.startDate).toFormat(W)}),e.jsx("td",{children:Q.fromISO(a.endDate).toFormat(W)}),e.jsx("td",{children:a.reason}),e.jsx("td",{children:(a==null?void 0:a.remarks)||"N/A"}),e.jsx("td",{children:e.jsxs(I,{children:[(y||i)&&e.jsx(X,{color:"gray",size:"sm",onClick:()=>R(a.status,a._id),children:e.jsx(Le,{})}),i&&e.jsx(X,{color:"red",size:"sm",onClick:()=>C(a._id),children:e.jsx(Se,{})})]})})]},a._id)})});return e.jsxs(P,{spacing:"xs",children:[e.jsxs(ae,{gap:"md",className:h.searchContainer,children:[e.jsx(te,{value:v,className:h.searchInput,placeholder:"Search by any field",icon:e.jsx(De,{size:16}),onChange:a=>{var r;return u((r=a.target)==null?void 0:r.value)}}),e.jsx(k,{variant:"filled",rightIcon:e.jsx(we,{size:16}),onClick:()=>f(!0),children:"Leave Application"})]}),e.jsx(z,{type:"always",h:"80vh",children:e.jsx(z,{w:"140vw",children:e.jsxs(ye,{border:1,bgcolor:S.white,withBorder:!0,children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:4,children:"Leave"}),e.jsx("th",{colSpan:1,children:"Person"}),e.jsx("th",{colSpan:6,children:"Details"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Proof"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Requested By"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Remarks"}),e.jsx("th",{children:"Actions"})]})]}),e.jsx("tbody",{children:p})]})})}),e.jsx(Ie,{title:"Add Leave Application",opened:b,onClose:()=>f(!1)}),e.jsx(Te,{title:"Update Leave Application",opened:l.visible,onClose:()=>o(),leaveId:l.leaveId,statusId:l.statusId})]})};export{Be as LeaveApplications,Be as default};
