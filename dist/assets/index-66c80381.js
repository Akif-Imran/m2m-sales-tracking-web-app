import{c as Ge,u as Te,a as ke,b as Oe,d as Ye,e as Re,f as v,s as Ee,g as Qe,h as $e,i as He,R as l,j as e,C as u,k as f,F as t,T as i,t as a,M as h,A as w,I as Z,l as j,m as S,n as b,r as Ve,G as C,o as _,p as O,q as Y,S as R,B as q,v as L,w as We,x as U,y as E,z as o,D as P,E as ee,Q as Be,H as se,J as Je,K as Ke,L as Xe,N as ne,_ as Ze,O as qe,P as Le,U as Ue,V as es,W as ie,X as ss,Y as A,Z as ns,$ as is,a0 as rs}from"./index-afd41c9d.js";import{I as ts,a as re}from"./IconTrashFilled-8b11607e.js";const as=Ge(M=>({})),ls=()=>{var X;const{theme:M}=as(),te=Te(),{classes:N}=ke(),{companyId:p,prospectId:z}=Oe();console.log(p);const D=Ye(),{state:{token:Q,user:F,isAdmin:ae}}=Re(),g=v(Ee),G=v(Qe),{data:$}=v($e),{data:T}=v(He),[oe,H]=l.useState(!1),[ce,le]=l.useState(!0),[d,de]=l.useState(),[xe,V]=l.useState([]),[he,y]=l.useState([]),[me,je]=l.useState([]),[ue,W]=l.useState([]),[n,I]=l.useState(),[pe,B]=l.useState(!1),[ge,k]=l.useState(!1),[Ce,J]=l.useState(!1),[ye,fe]=l.useState(!1),[we,K]=l.useState(!1),[Se,_e]=l.useState(""),[Ae,De]=l.useState(""),[Ie,ve]=l.useState("");l.useEffect(()=>{if(!p)return;const s=$.find(c=>c._id===p),r=G.filter(c=>c.customerId===p),x=T.filter(c=>c.customerId===p);if(V(x),je(r),W(r),de(s),r.length>0)if(z){const c=r.find(m=>m._id===z);c?(I(c),y(g.filter(m=>m.projectId===c._id))):(I(r[0]),y(g.filter(m=>m.projectId===r[0]._id)))}else I(r[0]),y(g.filter(c=>c.projectId===r[0]._id));le(c=>!1)},[p,z,$,G,T,g]);const be=s=>{const r=G.find(c=>c._id===s);I(r);const x=g.filter(c=>c.projectId===s);y(x)},Pe=s=>{ie({theme:M,title:"Delete Company",loading:!1,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:j.titleText,children:"Are you sure you want to delete this Company? This action is destructive and you will have to company support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete Company",onConfirm:()=>{D(ss({id:s,token:Q})).unwrap().then(r=>{A("Delete Company",r==null?void 0:r.message,r.success?"success":"error"),r.success&&D(ns(r.data._id))}).catch(r=>{console.log(r==null?void 0:r.message)})},onCancel:()=>A("Delete Company","Operation canceled!","error")})},Me=s=>{ie({theme:M,title:"Delete",loading:oe,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:j.titleText,children:"Are you sure you want to delete this Contact Person? This action is destructive and you will have to contact support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete",onConfirm:()=>{H(r=>!0),D(is({token:Q,id:s})).unwrap().then(r=>{A("Delete Contact",r==null?void 0:r.message,r.success?"success":"error"),r.success&&D(rs(r.data._id))}).catch(r=>{console.log("Delete Contact: ",r==null?void 0:r.message),A("Delete Contact","An error occurred","error")}).finally(()=>{H(r=>!1)})},onCancel:()=>A("Delete","Operation canceled!","error")})},Ne=s=>{_e(s);const r=T.filter(x=>x.name.toLowerCase().includes(s.toLowerCase())&&x.customerId===p);V(r)},ze=s=>{De(s);const r=me.filter(x=>x.name.toLowerCase().includes(s.toLowerCase()));W(r)},Fe=s=>{ve(s);const r=g.filter(x=>x.projectId===(n==null?void 0:n._id)).filter((x,c)=>{var m;return`${c+1}`.toLowerCase().includes(s.toLowerCase())||((m=x.contactPerson)==null?void 0:m.name.toLowerCase().includes(s.toLowerCase()))||x.meetingPlace.toLowerCase().includes(s.toLowerCase())});y(r)};return ce?e.jsx("div",{children:"Loading..."}):d?e.jsxs(e.Fragment,{children:[e.jsx(u,{...f,children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",w:"100%",children:[e.jsx(i,{...a,size:"xl",align:"center"}),e.jsx(i,{...a,size:"xl",align:"center",children:d==null?void 0:d.name}),e.jsxs(h,{withArrow:!0,withinPortal:!0,position:"right-start",children:[e.jsx(h.Target,{children:e.jsx(w,{children:e.jsx(Z,{size:16,stroke:1.3,color:j.titleText})})}),e.jsxs(h.Dropdown,{children:[e.jsx(h.Label,{children:"New"}),e.jsx(h.Item,{color:j.titleText,icon:e.jsx(S,{...b}),onClick:()=>k(!0),children:"Prospect"}),e.jsx(h.Item,{color:j.titleText,icon:e.jsx(S,{...b}),onClick:()=>J(!0),children:"Expense / Claim"}),e.jsx(h.Label,{children:"Options"}),e.jsx(h.Item,{c:j.titleText,icon:e.jsx(ts,{...b}),onClick:s=>{s.stopPropagation(),te(Ve.reports.list_nav(d==null?void 0:d._id))},children:"Reports"}),ae&&e.jsx(h.Item,{color:"red",icon:e.jsx(re,{size:b.size}),onClick:s=>{s.stopPropagation(),Pe(d==null?void 0:d._id)},children:"Delete"})]})]})]})}),e.jsxs(C,{children:[e.jsxs(C.Col,{span:3,children:[e.jsx(u,{...f,h:_(56),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...a,size:"md",children:"Prospects"}),e.jsxs(t,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(O,{size:"xs",radius:"md",value:Ae,className:N.searchInput,placeholder:"Search by any field",icon:e.jsx(Y,{size:16}),onChange:s=>{var r;return ze((r=s.target)==null?void 0:r.value)}}),e.jsx(w,{variant:"filled",size:"sm",color:"dark",onClick:()=>k(!0),children:e.jsx(S,{size:16,stroke:1.3,color:j.white})})]})]})}),e.jsx(R,{type:"scroll",h:"80vh",children:ue.map(s=>e.jsx(u,{shadow:"sm",mb:"xs",px:"sm",py:"xs",radius:"md",onClick:()=>be(s._id),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(t,{direction:"column",align:"flex-start",children:[e.jsx(i,{...a,children:s.name}),e.jsx(q,{variant:"filled",color:L[s.status],children:s==null?void 0:s.statusName})]}),(n==null?void 0:n._id)===s._id&&e.jsx(We,{size:24,color:j.titleText})]})},s._id))})]}),e.jsx(C.Col,{span:9,children:e.jsxs(U,{spacing:"xs",children:[e.jsxs(C,{children:[e.jsxs(C.Col,{span:7,children:[e.jsx(u,{...f,h:_(56),children:e.jsx(U,{spacing:"xs",children:e.jsxs(t,{direction:"row",align:"center",mt:_(4),children:[e.jsx(i,{...a,size:"md",children:"Details"}),(n==null?void 0:n.status)&&e.jsx(q,{ml:"lg",variant:"filled",color:L[n==null?void 0:n.status],children:n==null?void 0:n.statusName})]})})}),n&&e.jsx(u,{...E,children:e.jsxs(t,{direction:"column",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Name: "}),e.jsx(i,{...o,children:(n==null?void 0:n.name)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Type: "}),e.jsx(i,{...o,children:(n==null?void 0:n.type)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Salesman: "}),e.jsx(i,{...o,children:n!=null&&n.salesPerson?(n==null?void 0:n.salesPerson)===(F==null?void 0:F._id)?"(You)":(X=n==null?void 0:n.salesPersonValue)==null?void 0:X.name:"N/A"})]})]}),e.jsxs(t,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Value: "}),e.jsx(i,{...o,children:n!=null&&n.value?Intl.NumberFormat("en-US",{style:"currency",currency:n==null?void 0:n.value.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(n==null?void 0:n.value.amount):"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Contract Date: "}),e.jsx(i,{...o,children:n!=null&&n.contractDate?P.fromISO(n==null?void 0:n.contractDate).toFormat(ee):"N/A"})]})]}),e.jsxs(t,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Quotation: "}),e.jsx(i,{...o,children:(n==null?void 0:n.quotation)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Delivery Date: "}),e.jsx(i,{...o,children:n!=null&&n.deliveryDate?P.fromISO(n==null?void 0:n.deliveryDate).toFormat(ee):"N/A"})]})]}),e.jsxs(t,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Description: "}),e.jsx(i,{...o,children:(n==null?void 0:n.description)||"N/A"})]})]})})]}),e.jsxs(C.Col,{span:5,children:[e.jsx(u,{...f,h:_(56),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...a,size:"md",children:"Contacts"}),e.jsxs(t,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(O,{size:"xs",radius:"md",value:Se,className:N.searchInput,placeholder:"Search by any field",icon:e.jsx(Y,{size:16}),onChange:s=>{var r;return Ne((r=s.target)==null?void 0:r.value)}}),e.jsx(w,{variant:"filled",size:"sm",color:"dark",onClick:()=>B(!0),children:e.jsx(S,{size:16,stroke:1.3,color:j.white})})]})]})}),e.jsx(R,{type:"scroll",h:"36vh",children:xe.map(s=>e.jsx(u,{...E,children:e.jsx(l.Fragment,{children:e.jsxs(t,{direction:"row",justify:"flex-start",align:"flex-start",columnGap:"sm",children:[e.jsx(t,{my:"auto",children:e.jsx(Be,{src:s.businessCard?`${se}\\${s.businessCard}`:"/user.png",children:e.jsx(Je,{src:s.businessCard?`${se}\\${s.businessCard}`:"/user.png",size:88})},s._id)}),e.jsxs(t,{direction:"column",w:"100%",children:[e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(t,{direction:"row",align:"flex-start",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Name:"}),e.jsx(i,{...o,children:(s==null?void 0:s.name)||"N/A"})]}),e.jsxs(h,{withinPortal:!0,withArrow:!0,position:"bottom-end",children:[e.jsx(h.Target,{children:e.jsx(w,{children:e.jsx(Z,{size:16,stroke:1.3,color:j.titleText})})}),e.jsxs(h.Dropdown,{children:[e.jsx(h.Label,{children:"Options"}),e.jsx(h.Item,{color:"red",icon:e.jsx(re,{stroke:1.3,size:16}),onClick:()=>Me(s._id),children:"Delete"})]})]})]}),e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Email:"}),e.jsx(Ke,{...o,href:s==null?void 0:s.email,target:"_blank",c:"blue",children:(s==null?void 0:s.email)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Designation:"}),e.jsx(i,{...o,children:(s==null?void 0:s.designation)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Department:"}),e.jsx(i,{...o,children:(s==null?void 0:s.department)||"N/A"})]}),e.jsxs(t,{direction:"row",align:"flex-start",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Mobile:"}),e.jsx(i,{...o,children:(s==null?void 0:s.mobile)||"N/A"})]})]})]})},s._id)}))})]})]}),e.jsxs("div",{children:[e.jsx(u,{...f,h:_(56),children:e.jsxs(t,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...a,size:"md",children:"Meetings / Follow Up:"}),e.jsxs(t,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(O,{miw:"24vw",size:"xs",radius:"md",value:Ie,className:N.searchInput,placeholder:"Search by contact, place, No.",icon:e.jsx(Y,{size:16}),onChange:s=>{var r;return Fe((r=s.target)==null?void 0:r.value)}}),e.jsx(w,{variant:"filled",size:"sm",color:"dark",onClick:()=>K(!0),children:e.jsx(S,{size:16,stroke:1.3,color:j.white})})]})]})}),e.jsx(R,{type:"scroll",h:"33vh",children:he.map((s,r)=>{var c,m;const x=s!=null&&s.expensePrice?Intl.NumberFormat("en-US",{style:"currency",currency:s.expensePrice.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(s.expensePrice.amount):"N/A";return Xe.createElement(u,{...E,key:s._id},e.jsx(l.Fragment,{children:e.jsxs(t,{direction:"row",justify:"space-between",children:[e.jsxs(t,{direction:"column",my:"md",children:[e.jsxs(i,{...a,mb:"xs",children:["#",r+1]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Date/Time: "}),e.jsx(i,{...o,children:P.fromISO(s.meetingDate).toFormat(ne)})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Location:"}),e.jsx(i,{...o,children:s.meetingPlace})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Meeting With:"}),e.jsx(i,{...o,children:(c=s.contactPerson)==null?void 0:c.name})]}),e.jsxs(t,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Agenda:"}),e.jsx(i,{...o,children:s.meetingAgenda})]}),e.jsxs(t,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Summary:"}),e.jsx(i,{...o,children:s.meetingSummary})]})]}),e.jsxs(t,{direction:"column",my:"md",children:[e.jsx(i,{...a,mb:"xs",children:"Next Visit"}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Date/Time: "}),e.jsx(i,{...o,children:s.nextMeetingDate?P.fromISO(s.nextMeetingDate).toFormat(ne):"---"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Agenda:"}),e.jsx(i,{...o,children:s.nextMeetingAgenda})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Place:"}),e.jsx(i,{...o,children:s.nextMeetingPlace})]})]}),e.jsxs(t,{direction:"column",my:"md",children:[e.jsx(i,{...a,mb:"xs",children:"Expense / Claim"}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Name:"}),e.jsx(i,{...o,children:s==null?void 0:s.expenseName})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Type:"}),e.jsx(i,{...o,children:((m=s==null?void 0:s.expenseTypeDetail)==null?void 0:m.name)||"---"})]}),e.jsxs(t,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Price:"}),e.jsx(i,{...o,children:x})]})]})]})}))})})]})]})})]}),e.jsx(Ze,{title:"Add Prospect",opened:ge,onClose:()=>k(!1),companyId:d._id}),e.jsx(qe,{title:"Add Contact",opened:pe,companyId:d._id,onClose:()=>B(!1)}),e.jsx(Le,{title:"Add Follow Up",opened:we,projectId:n==null?void 0:n._id,companyId:d._id,onClose:()=>K(!1)}),e.jsx(Ue,{title:"Add Claim",opened:Ce,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>J(!1)}),e.jsx(es,{title:"Add Purchase Request",opened:ye,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>fe(!1)})]}):e.jsx("center",{children:"No such company exits..."})};export{ls as CompanyProspects,ls as default};
