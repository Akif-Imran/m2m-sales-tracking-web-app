import{c as ve,u as be,a as Pe,b as Me,d as Ne,e as Fe,f as _,s as Ge,g as ze,h as Te,i as ke,R as c,j as e,C as j,k as u,F as r,T as i,t as a,M as x,A as D,I as W,l as m,m as S,n as I,r as Oe,G as g,o as C,S as G,B,p as J,q as Ye,v as K,w as l,D as v,x as X,y as Z,z as q,Q as Re,E as U,H as Ee,J as Qe,K as $e,L,_ as Ve,N as He,O as We,P as Be,U as Je,V as ee,W as Ke,X as f,Y as Xe,Z as Ze,$ as qe}from"./index-cf1e1a34.js";import{I as Ue,a as se}from"./IconTrashFilled-51bb3c1a.js";const Le=ve(b=>({})),ns=()=>{var H;const{theme:b}=Le(),ne=be(),{classes:z}=Pe(),{companyId:p}=Me();console.log(p);const w=Ne(),{state:{token:T,user:P,isAdmin:ie}}=Fe(),A=_(Ge),M=_(ze),{data:k}=_(Te),{data:N}=_(ke),[re,O]=c.useState(!1),[te,ae]=c.useState(!0),[d,le]=c.useState(),[oe,ce]=c.useState([]),[de,Y]=c.useState([]),[xe,F]=c.useState([]),[n,R]=c.useState(),[he,E]=c.useState(!1),[me,Q]=c.useState(!1),[je,$]=c.useState(!1),[ue,pe]=c.useState(!1),[ge,Ce]=c.useState(""),[ye,V]=c.useState(!1),[fe,we]=c.useState("");c.useEffect(()=>{if(!p)return;const s=k.find(o=>o._id===p),t=M.filter(o=>o.customerId===p),h=N.filter(o=>o.customerId===p);Y(h),ce(t),le(s),t.length>0&&(R(t[0]),F(A.filter(o=>o.projectId===t[0]._id))),ae(o=>!1)},[p,k,M,N,A]);const Ae=s=>{const t=M.find(o=>o._id===s);R(t);const h=A.filter(o=>o.projectId===s);F(h)},_e=s=>{ee({theme:b,title:"Delete Company",loading:!1,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:m.titleText,children:"Are you sure you want to delete this Company? This action is destructive and you will have to company support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete Company",onConfirm:()=>{w(Ke({id:s,token:T})).unwrap().then(t=>{f("Delete Company",t==null?void 0:t.message,t.success?"success":"error"),t.success&&w(Xe(t.data._id))}).catch(t=>{console.log(t==null?void 0:t.message)})},onCancel:()=>f("Delete Company","Operation canceled!","error")})},De=s=>{ee({theme:b,title:"Delete",loading:re,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:m.titleText,children:"Are you sure you want to delete this Contact Person? This action is destructive and you will have to contact support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete",onConfirm:()=>{O(t=>!0),w(Ze({token:T,id:s})).unwrap().then(t=>{f("Delete Contact",t==null?void 0:t.message,t.success?"success":"error"),t.success&&w(qe(t.data._id))}).catch(t=>{console.log("Delete Contact: ",t==null?void 0:t.message),f("Delete Contact","An error occurred","error")}).finally(()=>{O(t=>!1)})},onCancel:()=>f("Delete","Operation canceled!","error")})},Se=s=>{Ce(s);const t=N.filter(h=>h.name.toLowerCase().includes(s.toLowerCase())&&h.customerId===p);Y(t)},Ie=s=>{we(s);const t=A.filter(h=>h.projectId===(n==null?void 0:n._id)).filter((h,o)=>{var y;return`${o+1}`.toLowerCase().includes(s.toLowerCase())||((y=h.contactPerson)==null?void 0:y.name.toLowerCase().includes(s.toLowerCase()))||h.meetingPlace.toLowerCase().includes(s.toLowerCase())});F(t)};return te?e.jsx("div",{children:"Loading..."}):d?e.jsxs(e.Fragment,{children:[e.jsx(j,{...u,children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",w:"100%",children:[e.jsx(i,{...a,size:"xl",align:"center"}),e.jsx(i,{...a,size:"xl",align:"center",children:d==null?void 0:d.name}),e.jsxs(x,{withArrow:!0,withinPortal:!0,position:"right-start",children:[e.jsx(x.Target,{children:e.jsx(D,{children:e.jsx(W,{size:16,stroke:1.3,color:m.titleText})})}),e.jsxs(x.Dropdown,{children:[e.jsx(x.Label,{children:"New"}),e.jsx(x.Item,{color:m.titleText,icon:e.jsx(S,{...I}),onClick:()=>Q(!0),children:"Prospect"}),e.jsx(x.Item,{color:m.titleText,icon:e.jsx(S,{...I}),onClick:()=>$(!0),children:"Expense / Claim"}),e.jsx(x.Label,{children:"Options"}),e.jsx(x.Item,{c:m.titleText,icon:e.jsx(Ue,{...I}),onClick:s=>{s.stopPropagation(),ne(Oe.reports.list_nav(d==null?void 0:d._id))},children:"Reports"}),ie&&e.jsx(x.Item,{color:"red",icon:e.jsx(se,{size:I.size}),onClick:s=>{s.stopPropagation(),_e(d==null?void 0:d._id)},children:"Delete"})]})]})]})}),e.jsxs(g,{children:[e.jsxs(g.Col,{span:3,children:[e.jsx(j,{...u,h:C(56),children:e.jsx(i,{...a,size:"md",mt:C(4),children:"Prospects"})}),e.jsx(G,{type:"scroll",h:"80vh",children:oe.map(s=>e.jsx(j,{shadow:"sm",mb:"xs",px:"sm",py:"xs",radius:"md",onClick:()=>Ae(s._id),children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(r,{direction:"column",align:"flex-start",children:[e.jsx(i,{...a,children:s.name}),e.jsx(B,{variant:"filled",color:J[s.status],children:s==null?void 0:s.statusName})]}),(n==null?void 0:n._id)===s._id&&e.jsx(Ye,{size:24,color:m.titleText})]})},s._id))})]}),e.jsx(g.Col,{span:9,children:e.jsxs(K,{spacing:"xs",children:[e.jsxs(g,{children:[e.jsxs(g.Col,{span:7,children:[e.jsx(j,{...u,h:C(56),children:e.jsx(K,{spacing:"xs",children:e.jsxs(r,{direction:"row",align:"center",mt:C(4),children:[e.jsx(i,{...a,size:"md",children:"Details"}),(n==null?void 0:n.status)&&e.jsx(B,{ml:"lg",variant:"filled",color:J[n==null?void 0:n.status],children:n==null?void 0:n.statusName})]})})}),n&&e.jsx(j,{...u,children:e.jsxs(r,{direction:"column",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Name: "}),e.jsx(i,{...l,children:(n==null?void 0:n.name)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Type: "}),e.jsx(i,{...l,children:(n==null?void 0:n.type)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Salesman: "}),e.jsx(i,{...l,children:n!=null&&n.salesPerson?(n==null?void 0:n.salesPerson)===(P==null?void 0:P._id)?"(You)":(H=n==null?void 0:n.salesPersonValue)==null?void 0:H.name:"N/A"})]})]}),e.jsxs(r,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Value: "}),e.jsx(i,{...l,children:n!=null&&n.value?Intl.NumberFormat("en-US",{style:"currency",currency:n==null?void 0:n.value.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(n==null?void 0:n.value.amount):"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Contract Date: "}),e.jsx(i,{...l,children:n!=null&&n.contractDate?v.fromISO(n==null?void 0:n.contractDate).toFormat(X):"N/A"})]})]}),e.jsxs(r,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Quotation: "}),e.jsx(i,{...l,children:(n==null?void 0:n.quotation)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Delivery Date: "}),e.jsx(i,{...l,children:n!=null&&n.deliveryDate?v.fromISO(n==null?void 0:n.deliveryDate).toFormat(X):"N/A"})]})]}),e.jsxs(r,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Description: "}),e.jsx(i,{...l,children:(n==null?void 0:n.description)||"N/A"})]})]})})]}),e.jsxs(g.Col,{span:5,children:[e.jsx(j,{...u,h:C(56),children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...a,size:"md",children:"Contacts"}),e.jsxs(r,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(Z,{size:"xs",radius:"md",value:ge,className:z.searchInput,placeholder:"Search by any field",icon:e.jsx(q,{size:16}),onChange:s=>{var t;return Se((t=s.target)==null?void 0:t.value)}}),e.jsx(D,{variant:"filled",size:"sm",color:"dark",onClick:()=>E(!0),children:e.jsx(S,{size:16,stroke:1.3,color:m.white})})]})]})}),e.jsx(G,{type:"scroll",h:"36vh",children:de.map(s=>e.jsx(j,{...u,children:e.jsx(c.Fragment,{children:e.jsxs(r,{direction:"row",justify:"flex-start",align:"flex-start",columnGap:"sm",children:[e.jsx(r,{my:"auto",children:e.jsx(Re,{src:s.businessCard?`${U}\\${s.businessCard}`:"/user.png",children:e.jsx(Ee,{src:s.businessCard?`${U}\\${s.businessCard}`:"/user.png",size:88})},s._id)}),e.jsxs(r,{direction:"column",w:"100%",children:[e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Name:"}),e.jsx(i,{...l,children:(s==null?void 0:s.name)||"N/A"})]}),e.jsxs(x,{withinPortal:!0,withArrow:!0,position:"bottom-end",children:[e.jsx(x.Target,{children:e.jsx(D,{children:e.jsx(W,{size:16,stroke:1.3,color:m.titleText})})}),e.jsxs(x.Dropdown,{children:[e.jsx(x.Label,{children:"Options"}),e.jsx(x.Item,{color:"red",icon:e.jsx(se,{stroke:1.3,size:16}),onClick:()=>De(s._id),children:"Delete"})]})]})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Email:"}),e.jsx(Qe,{...l,href:s==null?void 0:s.email,target:"_blank",c:"blue",children:(s==null?void 0:s.email)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Mobile No.:"}),e.jsx(i,{...l,children:(s==null?void 0:s.mobile)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Designation:"}),e.jsx(i,{...l,children:(s==null?void 0:s.designation)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Department:"}),e.jsx(i,{...l,children:(s==null?void 0:s.department)||"N/A"})]})]})]})},s._id)}))})]})]}),e.jsxs("div",{children:[e.jsx(j,{...u,h:C(56),children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...a,size:"md",children:"Meetings / Follow Up:"}),e.jsxs(r,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(Z,{miw:"24vw",size:"xs",radius:"md",value:fe,className:z.searchInput,placeholder:"Search by contact, place, No.",icon:e.jsx(q,{size:16}),onChange:s=>{var t;return Ie((t=s.target)==null?void 0:t.value)}}),e.jsx(D,{variant:"filled",size:"sm",color:"dark",onClick:()=>V(!0),children:e.jsx(S,{size:16,stroke:1.3,color:m.white})})]})]})}),e.jsx(G,{type:"scroll",h:"33vh",children:xe.map((s,t)=>{var o,y;const h=s!=null&&s.expensePrice?Intl.NumberFormat("en-US",{style:"currency",currency:s.expensePrice.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(s.expensePrice.amount):"N/A";return $e.createElement(j,{...u,key:s._id},e.jsx(c.Fragment,{children:e.jsxs(r,{direction:"row",justify:"space-between",children:[e.jsxs(r,{direction:"column",my:"md",children:[e.jsxs(i,{...a,mb:"xs",children:["#",t+1]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Date/Time: "}),e.jsx(i,{...l,children:v.fromISO(s.meetingDate).toFormat(L)})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Location:"}),e.jsx(i,{...l,children:s.meetingPlace})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Meeting With:"}),e.jsx(i,{...l,children:(o=s.contactPerson)==null?void 0:o.name})]}),e.jsxs(r,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Agenda:"}),e.jsx(i,{...l,children:s.meetingAgenda})]}),e.jsxs(r,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Summary:"}),e.jsx(i,{...l,children:s.meetingSummary})]})]}),e.jsxs(r,{direction:"column",my:"md",children:[e.jsx(i,{...a,mb:"xs",children:"Next Visit"}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Date/Time: "}),e.jsx(i,{...l,children:s.nextMeetingDate?v.fromISO(s.nextMeetingDate).toFormat(L):"---"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Agenda:"}),e.jsx(i,{...l,children:s.nextMeetingAgenda})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Place:"}),e.jsx(i,{...l,children:s.nextMeetingPlace})]})]}),e.jsxs(r,{direction:"column",my:"md",children:[e.jsx(i,{...a,mb:"xs",children:"Expense / Claim"}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Name:"}),e.jsx(i,{...l,children:s==null?void 0:s.expenseName})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Type:"}),e.jsx(i,{...l,children:((y=s==null?void 0:s.expenseTypeDetail)==null?void 0:y.name)||"---"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Price:"}),e.jsx(i,{...l,children:h})]})]})]})}))})})]})]})})]}),e.jsx(Ve,{title:"Add Prospect",opened:me,onClose:()=>Q(!1),companyId:d._id}),e.jsx(He,{title:"Add Contact",opened:he,companyId:d._id,onClose:()=>E(!1)}),e.jsx(We,{title:"Add Follow Up",opened:ye,projectId:n==null?void 0:n._id,companyId:d._id,onClose:()=>V(!1)}),e.jsx(Be,{title:"Add Claim",opened:je,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>$(!1)}),e.jsx(Je,{title:"Add Purchase Request",opened:ue,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>pe(!1)})]}):e.jsx("center",{children:"No such company exits..."})};export{ns as CompanyProspects,ns as default};
