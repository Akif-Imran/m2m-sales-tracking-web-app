import{c as W,ac as te,ad as b,ae as re,af as ne,a as N,e as U,f as T,ag as J,d as P,R as p,ah as K,ai as oe,Y as u,aj as le,ak as ie,j as e,al as X,am as Z,x as $,F as ee,J as z,o as R,an as ce,a9 as _,ao as de,p as ae,a6 as I,ap as ue,a7 as q,a8 as M,l as B,aq as se,a4 as O,S as F,ar as E,as as he,at as me,au as pe,Q as xe,H as V,B as Y,av as je,aw as fe,D as H,E as G,A as Q,ax as ge,ay as Ce,q as Le,m as De,ab as Se,W as we,T as ye,az as ve,aA as Ae}from"./index-df60243a.js";const ke=W(i=>({})),be=W(i=>({})),_e=te().shape({document:b().optional(),hasDocument:re().required("Type is required"),name:b().required("Name is required"),reason:b().required("Reason is required"),startDate:b().required("Start Date is required"),endDate:b().required("End Date is required"),status:ne().required("Status is required").min(1).max(3),type:b().required("Type is required")}),Re=({onClose:i,opened:w,title:g})=>{const{theme:c}=be(),{classes:h}=N(),{state:{token:C,user:x}}=U(),{leaveTypes:L}=T(J),y=P(),[v,j]=p.useState(!1),[m,A]=p.useState({}),s=K({initialValues:{document:"",hasDocument:!1,name:(x==null?void 0:x.name)||"",reason:"",startDate:"",endDate:"",status:1,type:"Paid"},validationSchema:_e,onSubmit:async(r,l)=>{if(console.log(r),j(a=>!0),r.hasDocument){const a=await oe(C,m);if(a.statusCode===200||a.statusCode===201)r.document=a.data;else{j(t=>!1),u("Add Leave",a==null?void 0:a.message,"error");return}}y(le({token:C,leave:{...r,document:r.document||""}})).unwrap().then(a=>{u("Add Leave",a==null?void 0:a.message,a!=null&&a.success?"success":"error"),a.success&&(y(ie(a.data)),l.resetForm(),i())}).catch(a=>{console.log("Add leave: ",a==null?void 0:a.message),u("Add Leave","An error occurred","error")}).finally(()=>{j(a=>!1)})}}),D=r=>{if(r===null){u("Proof Upload","Proof image not uploaded","error");return}A(a=>r);const l=new FileReader;l.onload=a=>{var n;const t=(n=a==null?void 0:a.target)==null?void 0:n.result;t&&s.setValues(S=>({...S,document:t,hasDocument:!0}))},l.readAsDataURL(r)},k=r=>{var a;if(!r)return;const l=(a=L.find(t=>t.value===r))==null?void 0:a.label;l&&s.setValues(t=>({...t,type:l}))},o=r=>{r&&s.setValues(l=>({...l,startDate:O(r)}))},d=r=>{r&&s.setValues(l=>({...l,endDate:O(r)}))},f=()=>{s.resetForm(),i()};return e.jsx(X,{size:"xl",withinPortal:!0,withOverlay:!0,title:g,opened:w,onClose:i,overlayProps:Z(c),children:e.jsxs($,{children:[e.jsxs(ee,{direction:"column",align:"center",justify:"flex-end",children:[s.values.document?e.jsx(z,{src:`${s.values.document}`,radius:"md",size:R(170)}):e.jsx(z,{src:"/user.png",radius:R(250),size:R(170)}),e.jsx("div",{className:h.fileUploadButton,children:e.jsx(ce,{onChange:D,accept:"image/png,image/jpeg",children:r=>e.jsx(_,{radius:"xl",variant:"filled",color:c.primaryColor,...r,rightIcon:e.jsx(de,{size:16,color:c.white,stroke:1.5}),children:"Proof"})})})]}),e.jsx(ae,{required:!0,withAsterisk:!1,label:"Name",name:"name",id:"name",value:s.values.name,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.name&&s.errors.name?`${s.errors.name}`:null}),e.jsx(I,{grow:!0,align:"flex-start",children:e.jsx(ue,{required:!0,withAsterisk:!1,searchable:!0,nothingFound:"No such type",label:"Type",value:s.values.type,onChange:k,data:L,error:s.touched.type&&s.errors.type?`${s.errors.type}`:null})}),e.jsxs(I,{grow:!0,align:"flex-start",children:[e.jsx(q,{required:!0,withAsterisk:!1,placeholder:"Select Start Date",name:"startDate",id:"startDate",label:"Start Date",onBlur:s.handleBlur,onChange:o,icon:e.jsx(M,{size:16,stroke:1.5,color:B.titleText}),error:s.touched.startDate&&s.errors.startDate?`${s.errors.startDate}`:null}),e.jsx(q,{required:!0,withAsterisk:!1,placeholder:"Select End Date",name:"endDate",id:"endDate",label:"End Date",onBlur:s.handleBlur,onChange:d,icon:e.jsx(M,{size:16,stroke:1.5,color:B.titleText}),error:s.touched.endDate&&s.errors.endDate?`${s.errors.endDate}`:null})]}),e.jsx(se,{minRows:5,maxRows:5,label:"Reason",name:"reason",id:"reason",value:s.values.reason,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.reason&&s.errors.reason?`${s.errors.reason}`:null}),e.jsxs(I,{align:"flex-end",position:"right",mt:R(32),children:[e.jsx(_,{variant:"outline",onClick:f,size:"xs",children:"Cancel"}),e.jsx(_,{size:"xs",variant:"filled",loading:v,onClick:()=>s.handleSubmit(),children:"Save"})]})]})})},Ie=({onClose:i,opened:w,title:g,leaveId:c,statusId:h})=>{const{theme:C,classes:x}=N(),L=P(),{state:{token:y}}=U(),{leaveStatus:v}=T(J),[j,m]=p.useState(!1),A=T(o=>o.leaves.data.find(d=>d._id===c));console.log(h,c);const s=K({initialValues:{leaveId:c,statusId:h,statusName:"",remarks:""},onSubmit:(o,d)=>{console.log(o),m(t=>!0);const{name:f,type:r,startDate:l,endDate:a}=A;L(he({id:o.leaveId,token:y,leave:{name:f,type:r,startDate:l,endDate:a,status:o.statusId,remarks:o.remarks}})).unwrap().then(t=>{u("Update Leave",t==null?void 0:t.message,t!=null&&t.success?"success":"error"),t.success&&(L(me(t.data)),d.resetForm(),i())}).catch(t=>{console.log("Update Leave",t==null?void 0:t.message),u("Update Leave","An error occurred","error")}).finally(()=>{m(t=>!1)})}}),D=o=>{var f;if(!o){u("Update Purchase Request Status","Invalid status value","error");return}const d=(f=v.find(r=>r.value===o))==null?void 0:f.label;d&&s.setValues(r=>({...r,statusId:parseInt(o),statusName:d}))},k=()=>{s.resetForm(),i()};return p.useEffect(()=>{s.setValues(o=>({...o,statusId:h,leaveId:c}))},[c,h]),e.jsx(X,{size:"lg",radius:"md",opened:w,onClose:i,title:g,scrollAreaComponent:F.Autosize,withinPortal:!0,withOverlay:!0,overlayProps:Z(C),children:e.jsxs($,{children:[e.jsx(E.Group,{name:"leaveStatus",value:s.values.statusId.toString(),onChange:D,children:e.jsx("div",{className:x.radioContainerRow,children:v.map(o=>e.jsx(E,{value:o.value,label:o.label},o.value))})}),e.jsx(se,{minRows:5,maxRows:5,label:"Remarks",name:"remarks",id:"remarks",value:s.values.remarks,onChange:s.handleChange,onBlur:s.handleBlur}),e.jsxs(I,{align:"flex-end",position:"right",mt:R(32),children:[e.jsx(_,{variant:"outline",onClick:k,size:"xs",children:"Cancel"}),e.jsx(_,{size:"xs",variant:"filled",loading:j,onClick:()=>s.handleSubmit(),children:"Save"})]})]})})},Be=()=>{ke();const{state:{isAdmin:i,isHR:w,user:g,token:c}}=U(),h=P(),{classes:C,theme:x}=N(),[L,y]=p.useState(""),[v,j]=p.useState(!1),m=T(pe),[A,s]=p.useState([]),[D,k]=p.useState({statusId:0,leaveId:"",visible:!1}),o=(a,t)=>{k(n=>({...n,statusId:a,leaveId:t,visible:!0}))},d=()=>k(a=>({...a,visible:!1})),f=a=>{if(y(a),i||w){const t=m.filter(n=>{var S;return n.name.toLowerCase().includes(a.toLocaleLowerCase())||n.type.toLowerCase().includes(a.toLocaleLowerCase())||((S=n==null?void 0:n.statusName)==null?void 0:S.toLowerCase().includes(a.toLocaleLowerCase()))||n.remarks.toLowerCase().includes(a.toLocaleLowerCase())||n.reason.toLowerCase().includes(a.toLocaleLowerCase())});s(t)}else{const t=m.filter(n=>{var S;return(n.name.toLowerCase().includes(a.toLocaleLowerCase())||n.type.toLowerCase().includes(a.toLocaleLowerCase())||((S=n==null?void 0:n.statusName)==null?void 0:S.toLowerCase().includes(a.toLocaleLowerCase()))||n.remarks.toLowerCase().includes(a.toLocaleLowerCase())||n.reason.toLowerCase().includes(a.toLocaleLowerCase()))&&n.createdBy===(g==null?void 0:g._id)});s(t)}};p.useEffect(()=>{s(m)},[m]);const r=a=>{we({theme:x,title:"Delete Leave",loading:!1,description:e.jsx(ye,{fw:"normal",fs:"normal",fz:"sm",color:B.titleText,children:"Are you sure you want to delete this Leave? This action is destructive and you will have to contact support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete Leave",onConfirm:()=>{h(ve({id:a,token:c})).unwrap().then(t=>{u("Delete Leave",(t==null?void 0:t.message)||"",t.success?"success":"error"),t.success&&h(Ae(t.data._id))}).catch(t=>{console.error(t==null?void 0:t.message),u("Delete Leave","An error occurred","error")})},onCancel:()=>u("Delete Leave","Operation canceled!","error")})},l=A.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:14,color:B.titleText,align:"center",children:"No Leaves"})}):e.jsx(e.Fragment,{children:A.map((a,t)=>{var n;return e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:e.jsx(xe,{src:a.document?`${V}\\${a.document}`:"/user.png",children:e.jsx(z,{src:a.document?`${V}\\${a.document}`:"/user.png",size:50})},a._id)}),e.jsx("td",{children:a.name}),e.jsx("td",{children:e.jsx(Y,{variant:"filled",color:je[a.status],children:a.statusName})}),e.jsx("td",{children:((n=a.requestByPerson)==null?void 0:n.name)||"N/A"}),e.jsx("td",{children:e.jsx(Y,{variant:"filled",color:fe[a.type],children:a.type})}),e.jsx("td",{children:H.fromISO(a.startDate).toFormat(G)}),e.jsx("td",{children:H.fromISO(a.endDate).toFormat(G)}),e.jsx("td",{children:a.reason}),e.jsx("td",{children:(a==null?void 0:a.remarks)||"N/A"}),e.jsx("td",{children:e.jsxs(I,{children:[(w||i)&&e.jsx(Q,{color:"gray",size:"sm",onClick:()=>o(a.status,a._id),children:e.jsx(ge,{})}),i&&e.jsx(Q,{color:"red",size:"sm",onClick:()=>r(a._id),children:e.jsx(Ce,{})})]})})]},a._id)})});return e.jsxs($,{spacing:"xs",children:[e.jsxs(ee,{gap:"md",className:C.searchContainer,children:[e.jsx(ae,{value:L,className:C.searchInput,placeholder:"Search by any field",icon:e.jsx(Le,{size:16}),onChange:a=>{var t;return f((t=a.target)==null?void 0:t.value)}}),e.jsx(_,{variant:"filled",rightIcon:e.jsx(De,{size:16}),onClick:()=>j(!0),children:"Leave Application"})]}),e.jsx(F,{type:"always",h:"80vh",children:e.jsx(F,{w:"140vw",children:e.jsxs(Se,{border:1,bgcolor:x.white,withBorder:!0,children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:4,children:"Leave"}),e.jsx("th",{colSpan:1,children:"Person"}),e.jsx("th",{colSpan:6,children:"Details"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Proof"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Requested By"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Remarks"}),e.jsx("th",{children:"Actions"})]})]}),e.jsx("tbody",{children:l})]})})}),e.jsx(Re,{title:"Add Leave Application",opened:v,onClose:()=>j(!1)}),e.jsx(Ie,{title:"Update Leave Application",opened:D.visible,onClose:()=>d(),leaveId:D.leaveId,statusId:D.statusId})]})};export{Be as LeaveApplications,Be as default};
