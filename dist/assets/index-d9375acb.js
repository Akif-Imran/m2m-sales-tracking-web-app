import{u as ve,a as Pe,b as Me,d as Ne,e as Fe,f as D,s as Ge,a1 as Te,h as ze,i as Oe,R as l,j as e,C as j,k as _,F as r,T as i,t as a,M as x,A as G,I as B,l as m,m as S,n as y,r as ke,G as p,o as g,S as T,B as q,v as J,w as Ye,x as K,y as I,z as o,D as b,E as X,p as Z,q as U,Q as Re,H as L,J as Ee,K as Qe,L as $e,N as ee,a2 as He,O as Ve,P as We,U as Be,V as qe,c as Je,W as se,X as Ke,Y as f,Z as Xe,$ as Ze,a0 as Ue}from"./index-5cd21567.js";import{I as Le,a as ne}from"./IconTrashFilled-30e84dac.js";const is=()=>{var W;const{theme:v}=es(),ie=ve(),{classes:z}=Pe(),{companyId:u}=Me();console.log(u);const w=Ne(),{state:{token:O,user:P,isAdmin:re}}=Fe(),A=D(Ge),M=D(Te),{data:k}=D(ze),{data:N}=D(Oe),[te,Y]=l.useState(!1),[ae,oe]=l.useState(!0),[d,ce]=l.useState(),[le,de]=l.useState([]),[xe,R]=l.useState([]),[he,F]=l.useState([]),[n,E]=l.useState(),[me,Q]=l.useState(!1),[je,$]=l.useState(!1),[ue,H]=l.useState(!1),[pe,V]=l.useState(!1),[ge,Ce]=l.useState(""),[ye,fe]=l.useState(!1),[we,Ae]=l.useState("");l.useEffect(()=>{if(!u)return;const s=k.find(c=>c._id===u),t=M.filter(c=>c.customerId===u),h=N.filter(c=>c.customerId===u);R(h),de(t),ce(s),t.length>0&&(E(t[0]),F(A.filter(c=>c.projectId===t[0]._id))),oe(c=>!1)},[u,k,M,N,A]);const De=s=>{const t=M.find(c=>c._id===s);E(t);const h=A.filter(c=>c.projectId===s);F(h)},_e=s=>{se({theme:v,title:"Delete Company",loading:!1,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:m.titleText,children:"Are you sure you want to delete this Company? This action is destructive and you will have to company support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete Company",onConfirm:()=>{w(Ke({id:s,token:O})).unwrap().then(t=>{f("Delete Company",t==null?void 0:t.message,t.success?"success":"error"),t.success&&w(Xe(t.data._id))}).catch(t=>{console.log(t==null?void 0:t.message)})},onCancel:()=>f("Delete Company","Operation canceled!","error")})},Se=s=>{se({theme:v,title:"Delete",loading:te,description:e.jsx(i,{fw:"normal",fs:"normal",fz:"sm",color:m.titleText,children:"Are you sure you want to delete this Contact Person? This action is destructive and you will have to contact support to restore data."}),cancelLabel:"Cancel",confirmLabel:"Delete",onConfirm:()=>{Y(t=>!0),w(Ze({token:O,id:s})).unwrap().then(t=>{f("Delete Contact",t==null?void 0:t.message,t.success?"success":"error"),t.success&&w(Ue(t.data._id))}).catch(t=>{console.log("Delete Contact: ",t==null?void 0:t.message),f("Delete Contact","An error occurred","error")}).finally(()=>{Y(t=>!1)})},onCancel:()=>f("Delete","Operation canceled!","error")})},Ie=s=>{Ce(s);const t=N.filter(h=>h.name.toLowerCase().includes(s.toLowerCase())&&h.customerId===u);R(t)},be=s=>{Ae(s);const t=A.filter(h=>h.projectId===(n==null?void 0:n._id)).filter((h,c)=>{var C;return`${c+1}`.toLowerCase().includes(s.toLowerCase())||((C=h.contactPerson)==null?void 0:C.name.toLowerCase().includes(s.toLowerCase()))||h.meetingPlace.toLowerCase().includes(s.toLowerCase())});F(t)};return ae?e.jsx("div",{children:"Loading..."}):d?e.jsxs(e.Fragment,{children:[e.jsx(j,{..._,children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",w:"100%",children:[e.jsx(i,{...a,size:"xl",align:"center"}),e.jsx(i,{...a,size:"xl",align:"center",children:d==null?void 0:d.name}),e.jsxs(x,{withArrow:!0,withinPortal:!0,position:"right-start",children:[e.jsx(x.Target,{children:e.jsx(G,{children:e.jsx(B,{size:16,stroke:1.3,color:m.titleText})})}),e.jsxs(x.Dropdown,{children:[e.jsx(x.Label,{children:"New"}),e.jsx(x.Item,{color:m.titleText,icon:e.jsx(S,{...y}),onClick:()=>$(!0),children:"Project"}),e.jsx(x.Item,{color:m.titleText,icon:e.jsx(S,{...y}),onClick:()=>V(!0),children:"Purchase Request"}),e.jsx(x.Item,{color:m.titleText,icon:e.jsx(S,{...y}),onClick:()=>H(!0),children:"Expense / Claim"}),e.jsx(x.Label,{children:"Options"}),e.jsx(x.Item,{c:m.titleText,icon:e.jsx(Le,{...y}),onClick:s=>{s.stopPropagation(),ie(ke.reports.list_nav(d==null?void 0:d._id))},children:"Reports"}),re&&e.jsx(x.Item,{color:"red",icon:e.jsx(ne,{size:y.size}),onClick:s=>{s.stopPropagation(),_e(d==null?void 0:d._id)},children:"Delete"})]})]})]})}),e.jsxs(p,{children:[e.jsxs(p.Col,{span:3,children:[e.jsx(j,{..._,h:g(56),children:e.jsx(i,{...a,size:"md",mt:g(4),children:"Prospects"})}),e.jsx(T,{type:"scroll",h:"80vh",children:le.map(s=>e.jsx(j,{shadow:"sm",mb:"xs",px:"sm",py:"xs",radius:"md",onClick:()=>De(s._id),children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(r,{direction:"column",align:"flex-start",children:[e.jsx(i,{...a,children:s.name}),e.jsx(q,{variant:"filled",color:J[s.status],children:s==null?void 0:s.statusName})]}),(n==null?void 0:n._id)===s._id&&e.jsx(Ye,{size:24,color:m.titleText})]})},s._id))})]}),e.jsx(p.Col,{span:9,children:e.jsxs(K,{spacing:"xs",children:[e.jsxs(p,{children:[e.jsxs(p.Col,{span:7,children:[e.jsx(j,{..._,h:g(56),children:e.jsx(K,{spacing:"xs",children:e.jsxs(r,{direction:"row",align:"center",mt:g(4),children:[e.jsx(i,{...a,size:"md",children:"Details"}),(n==null?void 0:n.status)&&e.jsx(q,{ml:"lg",variant:"filled",color:J[n==null?void 0:n.status],children:n==null?void 0:n.statusName})]})})}),n&&e.jsx(j,{...I,children:e.jsxs(r,{direction:"column",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Name: "}),e.jsx(i,{...o,children:(n==null?void 0:n.name)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Type: "}),e.jsx(i,{...o,children:(n==null?void 0:n.type)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Salesman: "}),e.jsx(i,{...o,children:n!=null&&n.salesPerson?(n==null?void 0:n.salesPerson)===(P==null?void 0:P._id)?"(You)":(W=n==null?void 0:n.salesPersonValue)==null?void 0:W.name:"N/A"})]})]}),e.jsxs(r,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Value: "}),e.jsx(i,{...o,children:n!=null&&n.value?Intl.NumberFormat("en-US",{style:"currency",currency:n==null?void 0:n.value.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(n==null?void 0:n.value.amount):"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Contract Date: "}),e.jsx(i,{...o,children:n!=null&&n.contractDate?b.fromISO(n==null?void 0:n.contractDate).toFormat(X):"N/A"})]})]}),e.jsxs(r,{direction:"row",align:"center",justify:"space-between",children:[e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Quotation: "}),e.jsx(i,{...o,children:(n==null?void 0:n.quotation)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Delivery Date: "}),e.jsx(i,{...o,children:n!=null&&n.deliveryDate?b.fromISO(n==null?void 0:n.deliveryDate).toFormat(X):"N/A"})]})]}),e.jsxs(r,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Description: "}),e.jsx(i,{...o,children:(n==null?void 0:n.description)||"N/A"})]})]})})]}),e.jsxs(p.Col,{span:5,children:[e.jsx(j,{..._,h:g(56),children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...a,size:"md",children:"Contacts"}),e.jsxs(r,{direction:"row",columnGap:"xs",align:"center",children:[e.jsx(Z,{size:"xs",radius:"md",value:ge,className:z.searchInput,placeholder:"Search by any field",icon:e.jsx(U,{size:16}),onChange:s=>{var t;return Ie((t=s.target)==null?void 0:t.value)}}),e.jsx(G,{variant:"filled",size:"sm",color:"dark",onClick:()=>Q(!0),children:e.jsx(S,{size:16,stroke:1.3,color:m.white})})]})]})}),e.jsx(T,{type:"scroll",h:"36vh",children:xe.map(s=>e.jsx(j,{...I,children:e.jsx(l.Fragment,{children:e.jsxs(r,{direction:"row",justify:"flex-start",align:"flex-start",columnGap:"sm",children:[e.jsx(r,{my:"auto",children:e.jsx(Re,{src:s.businessCard?`${L}\\${s.businessCard}`:"/user.png",children:e.jsx(Ee,{src:s.businessCard?`${L}\\${s.businessCard}`:"/user.png",size:88})},s._id)}),e.jsxs(r,{direction:"column",w:"100%",children:[e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsxs(r,{direction:"row",align:"flex-start",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Name:"}),e.jsx(i,{...o,children:(s==null?void 0:s.name)||"N/A"})]}),e.jsxs(x,{withinPortal:!0,withArrow:!0,position:"bottom-end",children:[e.jsx(x.Target,{children:e.jsx(G,{children:e.jsx(B,{size:16,stroke:1.3,color:m.titleText})})}),e.jsxs(x.Dropdown,{children:[e.jsx(x.Label,{children:"Options"}),e.jsx(x.Item,{color:"red",icon:e.jsx(ne,{stroke:1.3,size:16}),onClick:()=>Se(s._id),children:"Delete"})]})]})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Email:"}),e.jsx(Qe,{...o,href:s==null?void 0:s.email,target:"_blank",c:"blue",children:(s==null?void 0:s.email)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Designation:"}),e.jsx(i,{...o,children:(s==null?void 0:s.designation)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Department:"}),e.jsx(i,{...o,children:(s==null?void 0:s.department)||"N/A"})]}),e.jsxs(r,{direction:"row",align:"center",justify:"flex-start",children:[e.jsx(i,{...a,mr:"xs",children:"Mobile:"}),e.jsx(i,{...o,children:(s==null?void 0:s.mobile)||"N/A"})]})]})]})},s._id)}))})]})]}),e.jsxs("div",{children:[e.jsx(j,{...I,h:g(56),children:e.jsxs(r,{direction:"row",justify:"space-between",align:"center",children:[e.jsx(i,{...a,size:"md",children:"Meetings / Follow Up:"}),e.jsx(r,{direction:"row",columnGap:"xs",align:"center",children:e.jsx(Z,{miw:"24vw",size:"xs",radius:"md",value:we,className:z.searchInput,placeholder:"Search by contact, place, No.",icon:e.jsx(U,{size:16}),onChange:s=>{var t;return be((t=s.target)==null?void 0:t.value)}})})]})}),e.jsx(T,{type:"scroll",h:"33vh",children:he.map((s,t)=>{var c,C;const h=s!=null&&s.expensePrice?Intl.NumberFormat("en-US",{style:"currency",currency:s.expensePrice.currency,maximumFractionDigits:2,minimumFractionDigits:2}).format(s.expensePrice.amount):"N/A";return $e.createElement(j,{...I,key:s._id},e.jsx(l.Fragment,{children:e.jsxs(r,{direction:"row",justify:"space-between",children:[e.jsxs(r,{direction:"column",my:"md",children:[e.jsxs(i,{...a,mb:"xs",children:["#",t+1]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Date/Time: "}),e.jsx(i,{...o,children:b.fromISO(s.meetingDate).toFormat(ee)})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Location:"}),e.jsx(i,{...o,children:s.meetingPlace})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Meeting With:"}),e.jsx(i,{...o,children:(c=s.contactPerson)==null?void 0:c.name})]}),e.jsxs(r,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Agenda:"}),e.jsx(i,{...o,children:s.meetingAgenda})]}),e.jsxs(r,{direction:"row",align:"flex-start",columnGap:"sm",children:[e.jsx(i,{...a,children:"Summary:"}),e.jsx(i,{...o,children:s.meetingSummary})]})]}),e.jsxs(r,{direction:"column",my:"md",children:[e.jsx(i,{...a,mb:"xs",children:"Next Visit"}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Date/Time: "}),e.jsx(i,{...o,children:s.nextMeetingDate?b.fromISO(s.nextMeetingDate).toFormat(ee):"---"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Agenda:"}),e.jsx(i,{...o,children:s.nextMeetingAgenda})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Place:"}),e.jsx(i,{...o,children:s.nextMeetingPlace})]})]}),e.jsxs(r,{direction:"column",my:"md",children:[e.jsx(i,{...a,mb:"xs",children:"Expense / Claim"}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Name:"}),e.jsx(i,{...o,children:s==null?void 0:s.expenseName})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Type:"}),e.jsx(i,{...o,children:((C=s==null?void 0:s.expenseTypeDetail)==null?void 0:C.name)||"---"})]}),e.jsxs(r,{direction:"row",align:"center",columnGap:"sm",children:[e.jsx(i,{...a,children:"Price:"}),e.jsx(i,{...o,children:h})]})]})]})}))})})]})]})})]}),e.jsx(He,{title:"Add Project",opened:je,onClose:()=>$(!1),companyId:d._id}),e.jsx(Ve,{title:"Add Contact",opened:me,companyId:d._id,onClose:()=>Q(!1)}),e.jsx(We,{title:"Add Follow Up",opened:ye,projectId:n==null?void 0:n._id,companyId:d._id,onClose:()=>fe(!1)}),e.jsx(Be,{title:"Add Claim",opened:ue,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>H(!1)}),e.jsx(qe,{title:"Add Purchase Request",opened:pe,companyId:d._id,projectId:n==null?void 0:n._id,onClose:()=>V(!1)})]}):e.jsx("center",{children:"No such company exits..."})},es=Je(v=>({}));export{is as CompanyProjects,is as default};
